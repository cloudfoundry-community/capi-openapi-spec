paths:
  /v3/domains:
    post:
      summary: Create a domain
      description: Create a new domain.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Name of the domain
                internal:
                  type: boolean
                  description: Whether the domain is used for internal traffic
                router_group:
                  type: object
                  properties:
                    guid:
                      type: string
                      format: uuid
                      description: The desired router group guid
                organization:
                  type: object
                  properties:
                    data:
                      type: object
                      properties:
                        guid:
                          type: string
                          format: uuid
                          description: The organization guid
                shared_organizations:
                  type: array
                  items:
                    type: object
                    properties:
                      guid:
                        type: string
                        format: uuid
                        description: The organization guid
                metadata:
                  type: object
                  properties:
                    labels:
                      type: object
                      description: Labels applied to the domain
                    annotations:
                      type: object
                      description: Annotations applied to the domain
      responses:
        '201':
          description: Domain created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Domain'
      security:
        - OrgManager:
          - cloud_controller.write
      tags:
        - Domains

    get:
      summary: List domains
      description: Retrieve all domains the user has access to.
      parameters:
        - name: guids
          in: query
          schema:
            type: array
            items:
              type: string
          description: Comma-delimited list of guids to filter by
        - name: names
          in: query
          schema:
            type: array
            items:
              type: string
          description: Comma-delimited list of domain names to filter by
        - name: organization_guids
          in: query
          schema:
            type: array
            items:
              type: string
          description: Comma-delimited list of owning organization guids to filter by
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
          description: Page to display
        - name: per_page
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 5000
          description: Number of results per page
        - name: order_by
          in: query
          schema:
            type: string
          description: Value to sort by
        - name: label_selector
          in: query
          schema:
            type: string
          description: List of label selector requirements
        - name: created_ats
          in: query
          schema:
            type: string
          description: Timestamp to filter by
        - name: updated_ats
          in: query
          schema:
            type: string
          description: Timestamp to filter by
      responses:
        '200':
          description: List of domains
          content:
            application/json:
              schema:
                type: object
                properties:
                  pagination:
                    type: object
                    properties:
                      total_results:
                        type: integer
                      total_pages:
                        type: integer
                      first:
                        type: object
                        properties:
                          href:
                            type: string
                      last:
                        type: object
                        properties:
                          href:
                            type: string
                      next:
                        type: object
                        properties:
                          href:
                            type: string
                      previous:
                        type: object
                        properties:
                          href:
                            type: string
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/Domain'
      security: []
      tags:
        - Domains

  /v3/domains/{guid}:
    get:
      summary: Get a domain
      description: Retrieve a domain by its guid.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Domain details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Domain'
      security: []
      tags:
        - Domains

    patch:
      summary: Update a domain
      description: Update a domain by its guid.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                metadata:
                  type: object
                  properties:
                    labels:
                      type: object
                      description: Labels applied to the domain
                    annotations:
                      type: object
                      description: Annotations applied to the domain
      responses:
        '200':
          description: Domain updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Domain'
      security:
        - Admin:
          - cloud_controller.admin
        - OrgManager:
          - cloud_controller.write
      tags:
        - Domains

    delete:
      summary: Delete a domain
      description: Delete a domain by its guid.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '202':
          description: Domain deletion accepted
          headers:
            Location:
              schema:
                type: string
                format: uri
      security:
        - Admin:
          - cloud_controller.admin
        - OrgManager:
          - cloud_controller.write
      tags:
        - Domains

  /v3/domains/{guid}/relationships/shared_organizations:
    post:
      summary: Share a domain
      description: Share a domain with other organizations.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      guid:
                        type: string
                        format: uuid
                        description: The organization guid
      responses:
        '200':
          description: Domain shared successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Organization'
      security:
        - Admin:
          - cloud_controller.admin
        - OrgManager:
          - cloud_controller.write
      tags:
        - Domains

  /v3/domains/{guid}/relationships/shared_organizations/{org_guid}:
    delete:
      summary: Unshare a domain
      description: Unshare a domain from an organization.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: org_guid
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Domain unshared successfully
      security:
        - Admin:
          - cloud_controller.admin
        - OrgManager:
          - cloud_controller.write
      tags:
        - Domains

components:
  schemas:
    Domain:
      type: object
      properties:
        guid:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        name:
          type: string
        internal:
          type: boolean
        router_group:
          type: object
          properties:
            guid:
              type: string
              format: uuid
        supported_protocols:
          type: array
          items:
            type: string
        metadata:
          type: object
          properties:
            labels:
              type: object
            annotations:
              type: object
        relationships:
          type: object
          properties:
            organization:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    guid:
                      type: string
                      format: uuid
            shared_organizations:
              type: object
              properties:
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      guid:
                        type: string
                        format: uuid
        links:
          type: object
          properties:
            self:
              type: object
              properties:
                href:
                  type: string
            organization:
              type: object
              properties:
                href:
                  type: string
            route_reservations:
              type: object
              properties:
                href:
                  type: string
            shared_organizations:
              type: object
              properties:
                href:
                  type: string

    Organization:
      type: object
      properties:
        guid:
          type: string
          format: uuid
