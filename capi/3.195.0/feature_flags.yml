paths:
  /v3/feature_flags:
    get:
      summary: List feature flags
      description: |
        Retrieve all feature flags.
        
        Feature flags are used to enable or disable specific functionality in Cloud Foundry.
        They allow administrators to control the availability of features across the platform.
      tags:
        - Feature Flags
      parameters:
        - name: page
          in: query
          description: Page to display
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: per_page
          in: query
          description: Number of results per page
          schema:
            type: integer
            minimum: 1
            maximum: 5000
            default: 50
        - name: order_by
          in: query
          description: Value to sort by
          schema:
            type: string
            enum: [name, -name, updated_at, -updated_at]
            default: name
        - name: updated_ats
          in: query
          description: Filter by update time
          schema:
            type: string
        - name: names
          in: query
          description: Comma-delimited list of feature flag names to filter by
          schema:
            type: string
            example: user_org_creation,private_domain_creation
        - name: label_selector
          in: query
          description: Filter by label selector
          schema:
            type: string
            example: environment==production,tier!=backend
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                required:
                  - pagination
                  - resources
                properties:
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/FeatureFlag'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      security:
        - bearerAuth: []

  /v3/feature_flags/{name}:
    get:
      summary: Get a feature flag
      description: Retrieve detailed information about a specific feature flag.
      tags:
        - Feature Flags
      parameters:
        - name: name
          in: path
          required: true
          description: The name of the feature flag
          schema:
            type: string
            example: user_org_creation
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeatureFlag'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
      security:
        - bearerAuth: []

    patch:
      summary: Update a feature flag
      description: |
        Update the enabled state or custom error message of a feature flag.
        
        Only administrators can modify feature flags.
      tags:
        - Feature Flags
      parameters:
        - name: name
          in: path
          required: true
          description: The name of the feature flag
          schema:
            type: string
            example: user_org_creation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeatureFlagUpdate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeatureFlag'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/UnprocessableEntityError'
      security:
        - bearerAuth: []

components:
  schemas:
    FeatureFlag:
      type: object
      required:
        - name
        - enabled
        - updated_at
        - links
      properties:
        name:
          type: string
          description: Unique name of the feature flag
          example: user_org_creation
        enabled:
          type: boolean
          description: Whether the feature is enabled
          example: true
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the feature flag was last updated
        custom_error_message:
          type: string
          nullable: true
          description: Custom error message shown when the feature is disabled
          example: This feature is currently under maintenance
        metadata:
          type: object
          description: Additional metadata for the feature flag
          properties:
            labels:
              type: object
              description: Key-value pairs for organizing and filtering
              additionalProperties:
                type: string
              example:
                category: experimental
                risk-level: high
            annotations:
              type: object
              description: Key-value pairs for storing additional information
              additionalProperties:
                type: string
              example:
                contact: platform-team@example.com
                documentation: https://docs.example.com/features/user-org-creation
        links:
          type: object
          required:
            - self
          properties:
            self:
              type: object
              required:
                - href
              properties:
                href:
                  type: string
                  format: uri
                  example: https://api.example.org/v3/feature_flags/user_org_creation

    FeatureFlagUpdate:
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether to enable or disable the feature
          example: true
        custom_error_message:
          type: string
          nullable: true
          description: Custom error message shown when the feature is disabled
          maxLength: 5000
          example: This feature is currently under maintenance
        metadata:
          type: object
          description: Additional metadata for the feature flag
          properties:
            labels:
              type: object
              description: Key-value pairs for organizing and filtering
              additionalProperties:
                type: string
                maxLength: 63
              example:
                category: experimental
                risk-level: high
            annotations:
              type: object
              description: Key-value pairs for storing additional information
              additionalProperties:
                type: string
                maxLength: 5000
              example:
                contact: platform-team@example.com
                documentation: https://docs.example.com/features/user-org-creation

    Pagination:
      type: object
      required:
        - total_results
        - total_pages
        - first
        - last
      properties:
        total_results:
          type: integer
          description: Total number of results across all pages
          minimum: 0
        total_pages:
          type: integer
          description: Total number of pages
          minimum: 0
        first:
          type: object
          required:
            - href
          properties:
            href:
              type: string
              format: uri
              description: URL to the first page of results
        last:
          type: object
          required:
            - href
          properties:
            href:
              type: string
              format: uri
              description: URL to the last page of results
        next:
          type: object
          nullable: true
          properties:
            href:
              type: string
              format: uri
              description: URL to the next page of results
        previous:
          type: object
          nullable: true
          properties:
            href:
              type: string
              format: uri
              description: URL to the previous page of results

  responses:
    BadRequestError:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    UnauthorizedError:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    ForbiddenError:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFoundError:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    UnprocessableEntityError:
      description: Unprocessable Entity
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      description: Cloud Foundry UAA token