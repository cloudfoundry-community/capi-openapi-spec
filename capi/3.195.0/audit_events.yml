paths:
  /v3/audit_events/{guid}:
    get:
      summary: Retrieve an audit event
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the event
      responses:
        '200':
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditEvent'
      security:
        - Admin:
          - cloud_controller.admin
        - AdminReadOnly:
          - cloud_controller.admin_read_only
        - GlobalAuditor:
          - cloud_controller.global_auditor
        - OrgManager:
          - cloud_controller.read
        - SpaceAuditor:
          - cloud_controller.read
        - SpaceDeveloper:
          - cloud_controller.read
        - SpaceManager:
          - cloud_controller.read
        - SpaceSupporter:
          - cloud_controller.read
      tags:
        - Audit Events
      x-permissions:
        - Admin
        - Admin Read-Only
        - Global Auditor
        - Org Auditor
        - Space Auditor
        - Space Developer
        - Space Supporter

  /v3/audit_events:
    get:
      summary: List audit events
      parameters:
        - name: types
          in: query
          schema:
            type: array
            items:
              type: string
          description: Comma-delimited list of event types to filter by
        - name: target_guids
          in: query
          schema:
            type: array
            items:
              type: string
          description: Comma-delimited list of target guids to filter by. Also supports filtering by exclusion.
        - name: space_guids
          in: query
          schema:
            type: array
            items:
              type: string
          description: Comma-delimited list of space guids to filter by
        - name: organization_guids
          in: query
          schema:
            type: array
            items:
              type: string
          description: Comma-delimited list of organization guids to filter by
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
          description: Page to display
        - name: per_page
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 5000
          description: Number of results per page
        - name: order_by
          in: query
          schema:
            type: string
            enum: [created_at, updated_at, -created_at, -updated_at]
          description: Value to sort by
        - name: created_ats
          in: query
          schema:
            type: array
            items:
              type: string
              format: date-time
          description: Timestamp to filter by
        - name: updated_ats
          in: query
          schema:
            type: array
            items:
              type: string
              format: date-time
          description: Timestamp to filter by
      responses:
        '200':
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditEventList'
      security:
        - Admin:
          - cloud_controller.admin
        - AdminReadOnly:
          - cloud_controller.admin_read_only
        - GlobalAuditor:
          - cloud_controller.global_auditor
        - OrgManager:
          - cloud_controller.read
        - SpaceAuditor:
          - cloud_controller.read
        - SpaceDeveloper:
          - cloud_controller.read
        - SpaceManager:
          - cloud_controller.read
        - SpaceSupporter:
          - cloud_controller.read
      tags:
        - Audit Events
      x-permissions:
        - Admin
        - Admin Read-Only
        - Global Auditor
        - Org Auditor
        - Org Manager
        - Space Auditor
        - Space Developer
        - Space Manager
        - Space Supporter

components:
  schemas:
    AuditEvent:
      type: object
      properties:
        guid:
          type: string
          format: uuid
          description: Unique identifier for the event
        created_at:
          type: string
          format: date-time
          description: The time with zone when the object was created
        updated_at:
          type: string
          format: date-time
          description: The time with zone when the object was last updated
        type:
          type: string
          description: The type of the event
        actor:
          type: object
          properties:
            guid:
              type: string
              description: Unique identifier for the actor
            type:
              type: string
              description: The actor type
            name:
              type: string
              description: The name of the actor
        target:
          type: object
          properties:
            guid:
              type: string
              format: uuid
              description: Unique identifier for the target
            type:
              type: string
              description: The target type
            name:
              type: string
              description: The name of the target
        data:
          type: object
          description: Additional information about event
        space:
          type: object
          properties:
            guid:
              type: string
              format: uuid
              description: Unique identifier for the space where the event occurred
        organization:
          type: object
          properties:
            guid:
              type: string
              format: uuid
              description: Unique identifier for the organization where the event occurred
        links:
          type: object
          properties:
            self:
              type: object
              properties:
                href:
                  type: string
                  format: url
                  description: Link to the audit event resource

    AuditEventList:
      type: object
      properties:
        pagination:
          type: object
          properties:
            total_results:
              type: integer
              description: Total number of results
            total_pages:
              type: integer
              description: Total number of pages
            first:
              type: object
              properties:
                href:
                  type: string
                  format: url
                  description: Link to the first page
            last:
              type: object
              properties:
                href:
                  type: string
                  format: url
                  description: Link to the last page
            next:
              type: object
              nullable: true
              description: Link to the next page, if applicable
            previous:
              type: object
              nullable: true
              description: Link to the previous page, if applicable
        resources:
          type: array
          items:
            $ref: '#/components/schemas/AuditEvent'

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer

