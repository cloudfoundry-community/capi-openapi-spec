paths:
  /v3/isolation_segments:
    post:
      summary: Create an isolation segment
      description: Create a new isolation segment.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IsolationSegment'
      security:
        - Admin:
          - cloud_controller.admin

      responses:
        '201':
          description: Isolation segment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IsolationSegment'

    get:
      summary: List isolation segments
      description: Retrieve all isolation segments to which the user has access.
      parameters:
        - in: query
          name: guids
          schema:
            type: array
            items:
              type: string
          description: Comma-delimited list of isolation segment guids to filter by
        - in: query
          name: names
          schema:
            type: array
            items:
              type: string
          description: Comma-delimited list of isolation segment names to filter by
        - in: query
          name: organization_guids
          schema:
            type: array
            items:
              type: string
          description: Comma-delimited list of organization guids to filter by
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
          description: Page to display
        - in: query
          name: per_page
          schema:
            type: integer
            minimum: 1
            maximum: 5000
          description: Number of results per page
        - in: query
          name: order_by
          schema:
            type: string
            enum: [created_at, updated_at, name, -created_at, -updated_at, -name]
          description: Value to sort by; defaults to ascending. Prepend with - to sort descending
        - in: query
          name: label_selector
          schema:
            type: string
          description: A query string containing a list of label selector requirements
        - in: query
          name: created_ats
          schema:
            type: string
            format: date-time
          description: Timestamp to filter by
        - in: query
          name: updated_ats
          schema:
            type: string
            format: date-time
          description: Timestamp to filter by
      security: []

      responses:
        '200':
          description: List of isolation segments retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/IsolationSegment'

  /v3/isolation_segments/{guid}:
    get:
      summary: Get an isolation segment
      description: Retrieve an isolation segment to which the user has access.
      parameters:
        - in: path
          name: guid
          required: true
          schema:
            type: string
          description: The guid of the isolation segment
      security: []
      responses:
        '200':
          description: Isolation segment retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IsolationSegment'
    patch:
      summary: Update an isolation segment
      description: Update the name or metadata of an isolation segment.
      parameters:
        - in: path
          name: guid
          required: true
          schema:
            type: string
          description: The guid of the isolation segment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IsolationSegment'
      security:
        - Admin:
          - cloud_controller.admin
      responses:
        '200':
          description: Isolation segment updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IsolationSegment'
    delete:
      summary: Delete an isolation segment
      description: Delete an isolation segment.
      parameters:
        - in: path
          name: guid
          required: true
          schema:
            type: string
          description: The guid of the isolation segment
      security:
        - Admin:
          - cloud_controller.admin
      responses:
        '204':
          description: Isolation segment deleted successfully

  /v3/isolation_segments/{guid}/relationships/organizations:
    get:
      summary: List organizations relationship
      description: List the organizations entitled for the isolation segment.
      parameters:
        - in: path
          name: guid
          required: true
          schema:
            type: string
          description: The guid of the isolation segment
      responses:
        '200':
          description: List of organizations retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        guid:
                          type: string
                  links:
                    type: object
                    properties:
                      self:
                        type: object
                        properties:
                          href:
                            type: string
                            format: uri
                      related:
                        type: object
                        properties:
                          href:
                            type: string
                            format: uri
    post:
      summary: Entitle organizations for an isolation segment
      description: Entitle the specified organizations for the isolation segment.
      parameters:
        - in: path
          name: guid
          required: true
          schema:
            type: string
          description: The guid of the isolation segment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      guid:
                        type: string
      security:
        - Admin:
          - cloud_controller.admin
      responses:
        '200':
          description: Organizations entitled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        guid:
                          type: string
                  links:
                    type: object
                    properties:
                      self:
                        type: object
                        properties:
                          href:
                            type: string
                            format: uri
                      related:
                        type: object
                        properties:
                          href:
                            type: string
                            format: uri

  /v3/isolation_segments/{guid}/relationships/organizations/{org_guid}:
    delete:
      summary: Revoke entitlement to isolation segment for an organization
      description: Revoke the entitlement for the specified organization to the isolation segment.
      parameters:
        - in: path
          name: guid
          required: true
          schema:
            type: string
          description: The guid of the isolation segment
        - in: path
          name: org_guid
          required: true
          schema:
            type: string
          description: The guid of the organization
      security:
        - Admin:
          - cloud_controller.admin
      responses:
        '204':
          description: Entitlement revoked successfully

  /v3/isolation_segments/{guid}/relationships/spaces:
    get:
      summary: List spaces relationship
      description: List the spaces to which the isolation segment is assigned.
      parameters:
        - in: path
          name: guid
          required: true
          schema:
            type: string
          description: The guid of the isolation segment
      security: []
      responses:
        '200':
          description: List of spaces retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        guid:
                          type: string
                  links:
                    type: object
                    properties:
                      self:
                        type: object
                        properties:
                          href:
                            type: string
                            format: uri

  /v3/isolation_segments/{guid}/organizations:
    get:
      summary: List organizations for an isolation segment
      description: Retrieve all organizations that have been entitled to use this isolation segment.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
        - name: names
          in: query
          description: Comma-delimited list of organization names to filter by
          schema:
            type: string
        - name: guids
          in: query
          description: Comma-delimited list of organization guids to filter by
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
        - name: per_page
          in: query
          schema:
            type: integer
        - name: order_by
          in: query
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/Organization'
      security:
        - bearerAuth: []

  /v3/isolation_segments/{guid}/spaces:
    get:
      summary: List spaces for an isolation segment
      description: Retrieve all spaces that are assigned to this isolation segment.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
        - name: names
          in: query
          description: Comma-delimited list of space names to filter by
          schema:
            type: string
        - name: guids
          in: query
          description: Comma-delimited list of space guids to filter by
          schema:
            type: string
        - name: organization_guids
          in: query
          description: Comma-delimited list of organization guids to filter by
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
        - name: per_page
          in: query
          schema:
            type: integer
        - name: order_by
          in: query
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/Space'
      security:
        - bearerAuth: []

components:
  schemas:
    IsolationSegment:
      type: object
      properties:
        guid:
          type: string
        name:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        metadata:
          type: object
          properties:
            labels:
              type: object
              additionalProperties:
                type: string
            annotations:
              type: object
              additionalProperties:
                type: string
        links:
          type: object
          properties:
            self:
              type: object
              properties:
                href:
                  type: string
                  format: uri
            organizations:
              type: object
              properties:
                href:
                  type: string
                  format: uri

    Pagination:
      type: object
      properties:
        total_results:
          type: integer
        total_pages:
          type: integer
        first:
          type: object
          properties:
            href:
              type: string
              format: uri
        last:
          type: object
          properties:
            href:
              type: string
              format: uri
        next:
          type: object
          properties:
            href:
              type: string
              format: uri
        previous:
          type: object
          nullable: true
          properties:
            href:
              type: string
              format: uri
