paths:
  /v3/service_plans/{guid}/visibility:
    get:
      summary: Get a service plan visibility
      description: Retrieves the service plan visibility for a given plan.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
          description: The service plan GUID
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServicePlanVisibility'
    patch:
      summary: Update a service plan visibility
      description: Updates a service plan visibility. Replaces the existing list of organizations when the service plan is organization visible.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
          description: The service plan GUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ServicePlanVisibilityUpdate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServicePlanVisibility'
    post:
      summary: Apply a service plan visibility
      description: Applies a service plan visibility. Appends to the existing list of organizations when the service plan is organization visible.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
          description: The service plan GUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ServicePlanVisibilityApply'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServicePlanVisibility'
  /v3/service_plans/{guid}/visibility/{organization_guid}:
    delete:
      summary: Remove organization from a service plan visibility
      description: Removes an organization from a service plan visibility list of organizations. Defined only for service plans which are organization-restricted.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
          description: The service plan GUID
        - name: organization_guid
          in: path
          required: true
          schema:
            type: string
          description: The organization GUID
      responses:
        '204':
          description: No Content
components:
  schemas:
    ServicePlanVisibility:
      type: object
      properties:
        type:
          type: string
          description: Denotes the visibility of the plan; can be public, admin, organization, space
        organizations:
          type: array
          items:
            $ref: '#/components/schemas/OrganizationVisibility'
        space:
          type: object
          properties:
            guid:
              type: string
            name:
              type: string
    ServicePlanVisibilityUpdate:
      type: object
      properties:
        type:
          type: string
          description: Denotes the visibility of the plan; can be public, admin, organization
        organizations:
          type: array
          items:
            type: object
            properties:
              guid:
                type: string
    ServicePlanVisibilityApply:
      type: object
      properties:
        type:
          type: string
          description: Denotes the visibility of the plan; can be public, admin, organization
        organizations:
          type: array
          items:
            type: object
            properties:
              guid:
                type: string
    OrganizationVisibility:
      type: object
      properties:
        guid:
          type: string
          description: Unique identifier for the organization where the plan is available
        name:
          type: string
          description: Name of the organization where the plan is available
