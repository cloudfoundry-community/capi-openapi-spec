paths:
  /v3/revisions/{guid}:
    get:
      summary: Get a revision
      description: Retrieve a specific revision.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the revision
      security:
        - Admin:
          - cloud_controller.admin
        - AdminReadOnly:
          - cloud_controller.admin_read_only
        - GlobalAuditor:
          - cloud_controller.global_auditor
        - OrgManager:
          - cloud_controller.read
        - SpaceAuditor:
          - cloud_controller.read
        - SpaceDeveloper:
          - cloud_controller.write
        - SpaceManager:
          - cloud_controller.read
        - SpaceSupporter:
          - cloud_controller.read
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Revision'
  /v3/revisions/{guid}/environment_variables:
    get:
      summary: Get environment variables for a revision
      description: Retrieve the environment variables associated with the revision.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the revision
      security:
        - Admin:
          - cloud_controller.admin
        - AdminReadOnly:
          - cloud_controller.admin_read_only
        - SpaceDeveloper:
          - cloud_controller.write
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvironmentVariables'
  /v3/apps/{guid}/revisions:
    get:
      summary: List revisions for an app
      description: Retrieve revisions for an app the user has access to.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the app
        - name: versions
          in: query
          schema:
            type: array
            items:
              type: string
          description: Comma-delimited list of revision versions to filter by
        - name: label_selector
          in: query
          schema:
            type: string
          description: A query string containing a list of label selector requirements
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
          description: Page to display; valid values are integers >= 1
        - name: per_page
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 5000
          description: Number of results per page; valid values are 1 through 5000
        - name: order_by
          in: query
          schema:
            type: string
          description: Value to sort by. Defaults to ascending; prepend with - to sort descending.
        - name: created_ats
          in: query
          schema:
            type: string
          description: Timestamp to filter by; supports filtering with relational operators
        - name: updated_ats
          in: query
          schema:
            type: string
          description: Timestamp to filter by; supports filtering with relational operators
      security:
        - Admin:
          - cloud_controller.admin
        - AdminReadOnly:
          - cloud_controller.admin_read_only
        - GlobalAuditor:
          - cloud_controller.global_auditor
        - OrgManager:
          - cloud_controller.read
        - SpaceAuditor:
          - cloud_controller.read
        - SpaceDeveloper:
          - cloud_controller.write
        - SpaceManager:
          - cloud_controller.read
        - SpaceSupporter:
          - cloud_controller.read
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RevisionsList'
  /v3/apps/{guid}/revisions/deployed:
    get:
      summary: List deployed revisions for an app
      description: Retrieve deployed revisions for an app the user has access to. Deployed revisions are revisions that are linked to started processes in the app.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the app
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
          description: Page to display; valid values are integers >= 1
        - name: per_page
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 5000
          description: Number of results per page; valid values are 1 through 5000
        - name: order_by
          in: query
          schema:
            type: string
          description: Value to sort by. Defaults to ascending; prepend with - to sort descending.
      security:
        - Admin:
          - cloud_controller.admin
        - AdminReadOnly:
          - cloud_controller.admin_read_only
        - GlobalAuditor:
          - cloud_controller.global_auditor
        - OrgManager:
          - cloud_controller.read
        - SpaceAuditor:
          - cloud_controller.read
        - SpaceDeveloper:
          - cloud_controller.write
        - SpaceManager:
          - cloud_controller.read
        - SpaceSupporter:
          - cloud_controller.read
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RevisionsList'
  /v3/revisions/{guid}:
    patch:
      summary: Update a revision
      description: Update metadata for a specific revision.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
          description: Unique identifier for the revision
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                metadata:
                  type: object
                  properties:
                    labels:
                      type: object
                      additionalProperties:
                        type: string
                    annotations:
                      type: object
                      additionalProperties:
                        type: string
      security:
        - Admin:
          - cloud_controller.admin
        - SpaceDeveloper:
          - cloud_controller.write
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Revision'

  /v3/revisions/{guid}/deployed_processes:
    get:
      summary: Get deployed processes for a revision
      description: |
        Retrieve information about the processes that are currently deployed for this revision.
        This shows which process types are running with this revision's configuration.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  processes:
                    type: array
                    items:
                      type: object
                      properties:
                        guid:
                          type: string
                          format: uuid
                        type:
                          type: string
                          example: web
      security:
        - bearerAuth: []

  /v3/revisions/{guid}/environment_variables:
    get:
      summary: Get environment variables for a revision
      description: |
        Retrieve the environment variables that were set when this revision was created.
        This includes both user-provided environment variables and system environment variables.
      parameters:
        - name: guid
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  var:
                    type: object
                    additionalProperties:
                      type: string
                    description: User-provided environment variables
                  links:
                    type: object
                    properties:
                      self:
                        type: object
                        properties:
                          href:
                            type: string
                      app:
                        type: object
                        properties:
                          href:
                            type: string
                      revision:
                        type: object
                        properties:
                          href:
                            type: string
      security:
        - bearerAuth: []

components:
  schemas:
    Revision:
      type: object
      properties:
        guid:
          type: string
        version:
          type: integer
        droplet:
          type: object
          properties:
            guid:
              type: string
        processes:
          type: object
          additionalProperties:
            type: object
            properties:
              command:
                type: string
        sidecars:
          type: array
          items:
            $ref: '#/components/schemas/Sidecar'
        description:
          type: string
        deployable:
          type: boolean
        relationships:
          type: object
          properties:
            app:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    guid:
                      type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        metadata:
          type: object
          properties:
            labels:
              type: object
              additionalProperties:
                type: string
            annotations:
              type: object
              additionalProperties:
                type: string
        links:
          type: object
          properties:
            self:
              type: object
              properties:
                href:
                  type: string
            app:
              type: object
              properties:
                href:
                  type: string
            environment_variables:
              type: object
              properties:
                href:
                  type: string
    EnvironmentVariables:
      type: object
      properties:
        var:
          type: object
          additionalProperties:
            type: string
        links:
          type: object
          properties:
            self:
              type: object
              properties:
                href:
                  type: string
            revision:
              type: object
              properties:
                href:
                  type: string
            app:
              type: object
              properties:
                href:
                  type: string
    RevisionsList:
      type: object
      properties:
        pagination:
          type: object
          properties:
            total_results:
              type: integer
            total_pages:
              type: integer
            first:
              type: object
              properties:
                href:
                  type: string
            last:
              type: object
              properties:
                href:
                  type: string
            next:
              type: object
              nullable: true
              properties:
                href:
                  type: string
            previous:
              type: object
              nullable: true
              properties:
                href:
                  type: string
        resources:
          type: array
          items:
            $ref: '#/components/schemas/Revision'
    Sidecar:
      type: object
      properties:
        name:
          type: string
        command:
          type: string
        process_types:
          type: array
          items:
            type: string
        memory_in_mb:
          type: integer

