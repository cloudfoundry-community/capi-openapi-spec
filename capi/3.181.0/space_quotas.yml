paths:
  /v3/space_quotas:
    post:
      summary: "Create a space quota"
      description: "Create a new space quota scoped to a specific organization."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - "name"
                - "relationships"
              properties:
                name:
                  type: "string"
                relationships:
                  type: object
                  properties:
                    organization:
                      type: object
                      properties:
                        data:
                          type: object
                          properties:
                            guid:
                              type: "string"
                apps:
                  type: object
                  properties:
                    total_memory_in_mb:
                      type: integer
                      nullable: true
                    per_process_memory_in_mb:
                      type: integer
                      nullable: true
                    log_rate_limit_in_bytes_per_second:
                      type: integer
                      nullable: true
                    total_instances:
                      type: integer
                      nullable: true
                    per_app_tasks:
                      type: integer
                      nullable: true
                services:
                  type: object
                  properties:
                    paid_services_allowed:
                      type: boolean
                    total_service_instances:
                      type: integer
                      nullable: true
                    total_service_keys:
                      type: integer
                      nullable: true
                routes:
                  type: object
                  properties:
                    total_routes:
                      type: integer
                      nullable: true
                    total_reserved_ports:
                      type: integer
                      nullable: true
      responses:
        '201':
          description: "Created"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SpaceQuota'

    get:
      summary: "List space quotas"
      description: "List all space quota resources that the user has permission to view."
      parameters:
        - name: "guids"
          in: query
          schema:
            type: "string"
        - name: "names"
          in: query
          schema:
            type: "string"
        - name: "organization_guids"
          in: query
          schema:
            type: "string"
        - name: "space_guids"
          in: query
          schema:
            type: "string"
        - name: "page"
          in: query
          schema:
            type: integer
            minimum: 1
        - name: "per_page"
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 5000
        - name: "order_by"
          in: query
          schema:
            type: "string"
            enum: ["created_at", "updated_at"]
        - name: "created_ats"
          in: query
          schema:
            type: "string"
        - name: "updated_ats"
          in: query
          schema:
            type: "string"
      responses:
        '200':
          description: "OK"
          content:
            application/json:
              schema:
                type: object
                properties:
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/SpaceQuota'

  /v3/space_quotas/{guid}:
    get:
      summary: "Get a space quota"
      description: "Retrieve a space quota by GUID."
      parameters:
        - name: "guid"
          in: path
          required: true
          schema:
            type: "string"
      responses:
        '200':
          description: "OK"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SpaceQuota'

    patch:
      summary: "Update a space quota"
      description: "Update the specified parameters of a space quota."
      parameters:
        - name: "guid"
          in: path
          required: true
          schema:
            type: "string"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: "string"
                apps:
                  type: object
                  properties:
                    total_memory_in_mb:
                      type: integer
                      nullable: true
                    per_process_memory_in_mb:
                      type: integer
                      nullable: true
                    log_rate_limit_in_bytes_per_second:
                      type: integer
                      nullable: true
                    total_instances:
                      type: integer
                      nullable: true
                    per_app_tasks:
                      type: integer
                      nullable: true
                services:
                  type: object
                  properties:
                    paid_services_allowed:
                      type: boolean
                    total_service_instances:
                      type: integer
                      nullable: true
                    total_service_keys:
                      type: integer
                      nullable: true
                routes:
                  type: object
                  properties:
                    total_routes:
                      type: integer
                      nullable: true
                    total_reserved_ports:
                      type: integer
                      nullable: true
      responses:
        '200':
          description: "OK"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SpaceQuota'

    delete:
      summary: "Delete a space quota"
      description: "Delete a space quota by GUID."
      parameters:
        - name: "guid"
          in: path
          required: true
          schema:
            type: "string"
      responses:
        '202':
          description: "Accepted"

  /v3/space_quotas/{quota_guid}/relationships/spaces:
    post:
      summary: "Apply a space quota to spaces"
      description: "Apply a space quota to one or more spaces."
      parameters:
        - name: "quota_guid"
          in: path
          required: true
          schema:
            type: "string"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      guid:
                        type: "string"
      responses:
        '200':
          description: "OK"
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        guid:
                          type: "string"
                  links:
                    type: object
                    properties:
                      self:
                        type: "string"

  /v3/space_quotas/{quota_guid}/relationships/spaces/{space_guid}:
    delete:
      summary: "Remove a space quota from a space"
      description: "Remove a space quota from a space."
      parameters:
        - name: "quota_guid"
          in: path
          required: true
          schema:
            type: "string"
        - name: "space_guid"
          in: path
          required: true
          schema:
            type: "string"
      responses:
        '204':
          description: "No Content"

components:
  schemas:
    SpaceQuota:
      type: object
      properties:
        guid:
          type: "string"
        created_at:
          type: "string"
          format: "date-time"
        updated_at:
          type: "string"
          format: "date-time"
        name:
          type: "string"
        apps:
          type: object
          properties:
            total_memory_in_mb:
              type: integer
              nullable: true
            per_process_memory_in_mb:
              type: integer
              nullable: true
            log_rate_limit_in_bytes_per_second:
              type: integer
              nullable: true
            total_instances:
              type: integer
              nullable: true
            per_app_tasks:
              type: integer
              nullable: true
        services:
          type: object
          properties:
            paid_services_allowed:
              type: boolean
            total_service_instances:
              type: integer
              nullable: true
            total_service_keys:
              type: integer
              nullable: true
        routes:
          type: object
          properties:
            total_routes:
              type: integer
              nullable: true
            total_reserved_ports:
              type: integer
              nullable: true
        relationships:
          type: object
          properties:
            organization:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    guid:
                      type: "string"
            spaces:
              type: object
              properties:
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      guid:
                        type: "string"
        links:
          type: object
          properties:
            self:
              type: "string"
              format: "uri"
            organization:
              type: "string"
              format: "uri"

    Pagination:
      type: object
      properties:
        total_results:
          type: integer
        total_pages:
          type: integer
        first:
          type: object
          properties:
            href:
              type: "string"
              format: "uri"
        last:
          type: object
          properties:
            href:
              type: "string"
              format: "uri"
        next:
          type: object
          nullable: true
          properties:
            href:
              type: "string"
              format: "uri"
        previous:
          type: object
          nullable: true
          properties:
            href:
              type: "string"
              format: "uri"
