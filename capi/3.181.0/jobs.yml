paths:
  /v3/jobs:
    get:
      summary: List jobs
      description: |
        Retrieve all jobs the user has access to.
        Jobs track the status of asynchronous operations in Cloud Foundry.
      parameters:
        - name: guids
          in: query
          description: Comma-delimited list of job guids to filter by
          schema:
            type: string
        - name: states
          in: query
          description: Comma-delimited list of job states to filter by
          schema:
            type: string
            example: PROCESSING,COMPLETE,FAILED
        - name: space_guids
          in: query
          description: Comma-delimited list of space guids to filter by
          schema:
            type: string
        - name: organization_guids
          in: query
          description: Comma-delimited list of organization guids to filter by
          schema:
            type: string
        - name: page
          in: query
          description: Page to display
          schema:
            type: integer
            minimum: 1
        - name: per_page
          in: query
          description: Number of results per page
          schema:
            type: integer
            minimum: 1
            maximum: 5000
        - name: order_by
          in: query
          description: |
            Value to sort by. Defaults to ascending.
            Prepend with - to sort descending.
            Valid values: created_at, updated_at
          schema:
            type: string
            example: -created_at
        - name: created_ats
          in: query
          description: |
            Filter by creation timestamp. Supports multiple formats:
            - Exact match: created_ats=2020-01-01T00:00:00Z
            - Greater than: created_ats[gt]=2020-01-01T00:00:00Z
            - Greater than or equal: created_ats[gte]=2020-01-01T00:00:00Z
            - Less than: created_ats[lt]=2020-01-01T00:00:00Z
            - Less than or equal: created_ats[lte]=2020-01-01T00:00:00Z
            - Range: created_ats[gt]=2020-01-01T00:00:00Z&created_ats[lt]=2020-12-31T00:00:00Z
          schema:
            type: string
        - name: updated_ats
          in: query
          description: |
            Filter by update timestamp. Supports multiple formats:
            - Exact match: updated_ats=2020-01-01T00:00:00Z
            - Greater than: updated_ats[gt]=2020-01-01T00:00:00Z
            - Greater than or equal: updated_ats[gte]=2020-01-01T00:00:00Z
            - Less than: updated_ats[lt]=2020-01-01T00:00:00Z
            - Less than or equal: updated_ats[lte]=2020-01-01T00:00:00Z
            - Range: updated_ats[gt]=2020-01-01T00:00:00Z&updated_ats[lt]=2020-12-31T00:00:00Z
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                  resources:
                    type: array
                    items:
                      $ref: '#/components/schemas/Job'
      security:
        - bearerAuth: []

  /v3/jobs/{guid}:
    get:
      summary: Get a job
      description: |
        Retrieve a job by its GUID.
        
        Jobs represent asynchronous operations in Cloud Foundry. When an endpoint returns a 202 Accepted response with a Location header pointing to a job, 
        you can poll this endpoint to check the status of the operation.
        
        Job states:
        - PROCESSING: The job is currently being processed
        - COMPLETE: The job completed successfully
        - FAILED: The job failed; check the errors array for details
        - POLLING: The job is polling a remote resource
      parameters:
        - name: guid
          in: path
          required: true
          description: The job GUID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
        '404':
          description: Not Found
      security:
        - bearerAuth: []

components:
  schemas:
    Job:
      type: object
      required:
        - guid
        - created_at
        - updated_at
        - operation
        - state
        - links
      properties:
        guid:
          type: string
          format: uuid
          description: Unique identifier for the job
        created_at:
          type: string
          format: date-time
          description: The time the job was created
        updated_at:
          type: string
          format: date-time
          description: The time the job was last updated
        operation:
          type: string
          description: |
            The type of operation the job is performing.
            Examples: app.delete, space.apply_manifest, service_instance.create
        state:
          type: string
          enum: [PROCESSING, COMPLETE, FAILED, POLLING]
          description: Current state of the job
        errors:
          type: array
          nullable: true
          description: |
            Array of errors that occurred during job processing.
            Only present when state is FAILED.
          items:
            type: object
            properties:
              code:
                type: integer
                description: Numeric error code
              title:
                type: string
                description: Short error title
              detail:
                type: string
                description: Detailed error message
        warnings:
          type: array
          nullable: true
          description: |
            Array of warnings generated during job processing.
            May be present even when job completes successfully.
          items:
            type: object
            properties:
              detail:
                type: string
                description: Warning message
        resource:
          type: object
          nullable: true
          description: |
            Information about the resource that was created or modified by the job.
            Only present for COMPLETE jobs that create or modify resources.
          properties:
            guid:
              type: string
              format: uuid
              description: GUID of the affected resource
            type:
              type: string
              description: Type of the resource (e.g., 'app', 'space', 'service_instance')
        links:
          type: object
          properties:
            self:
              type: object
              properties:
                href:
                  type: string
                  format: uri
                  description: URL to this job
            app:
              type: object
              nullable: true
              description: Link to associated app (if applicable)
              properties:
                href:
                  type: string
                  format: uri
            space:
              type: object
              nullable: true
              description: Link to associated space (if applicable)
              properties:
                href:
                  type: string
                  format: uri
            organization:
              type: object
              nullable: true
              description: Link to associated organization (if applicable)
              properties:
                href:
                  type: string
                  format: uri

    Pagination:
      type: object
      properties:
        total_results:
          type: integer
          description: Total number of results
        total_pages:
          type: integer
          description: Total number of pages
        first:
          type: object
          properties:
            href:
              type: string
              format: uri
        last:
          type: object
          properties:
            href:
              type: string
              format: uri
        next:
          type: object
          nullable: true
          properties:
            href:
              type: string
              format: uri
        previous:
          type: object
          nullable: true
          properties:
            href:
              type: string
              format: uri